{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "    <div class=\"bk-root\">\n",
       "        <a href=\"https://bokeh.pydata.org\" target=\"_blank\" class=\"bk-logo bk-logo-small bk-logo-notebook\"></a>\n",
       "        <span id=\"fe51ec03-12d8-40da-bd85-7615c8ed6cfb\">Loading BokehJS ...</span>\n",
       "    </div>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/javascript": [
       "\n",
       "(function(root) {\n",
       "  function now() {\n",
       "    return new Date();\n",
       "  }\n",
       "\n",
       "  var force = true;\n",
       "\n",
       "  if (typeof (root._bokeh_onload_callbacks) === \"undefined\" || force === true) {\n",
       "    root._bokeh_onload_callbacks = [];\n",
       "    root._bokeh_is_loading = undefined;\n",
       "  }\n",
       "\n",
       "\n",
       "  \n",
       "  if (typeof (root._bokeh_timeout) === \"undefined\" || force === true) {\n",
       "    root._bokeh_timeout = Date.now() + 5000;\n",
       "    root._bokeh_failed_load = false;\n",
       "  }\n",
       "\n",
       "  var NB_LOAD_WARNING = {'data': {'text/html':\n",
       "     \"<div style='background-color: #fdd'>\\n\"+\n",
       "     \"<p>\\n\"+\n",
       "     \"BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \\n\"+\n",
       "     \"may be due to a slow or bad network connection. Possible fixes:\\n\"+\n",
       "     \"</p>\\n\"+\n",
       "     \"<ul>\\n\"+\n",
       "     \"<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\\n\"+\n",
       "     \"<li>use INLINE resources instead, as so:</li>\\n\"+\n",
       "     \"</ul>\\n\"+\n",
       "     \"<code>\\n\"+\n",
       "     \"from bokeh.resources import INLINE\\n\"+\n",
       "     \"output_notebook(resources=INLINE)\\n\"+\n",
       "     \"</code>\\n\"+\n",
       "     \"</div>\"}};\n",
       "\n",
       "  function display_loaded() {\n",
       "    if (root.Bokeh !== undefined) {\n",
       "      var el = document.getElementById(\"fe51ec03-12d8-40da-bd85-7615c8ed6cfb\");\n",
       "      if (el != null) {\n",
       "        el.textContent = \"BokehJS \" + Bokeh.version + \" successfully loaded.\";\n",
       "      }\n",
       "    } else if (Date.now() < root._bokeh_timeout) {\n",
       "      setTimeout(display_loaded, 100)\n",
       "    }\n",
       "  }\n",
       "\n",
       "\n",
       "  function run_callbacks() {\n",
       "    try {\n",
       "      root._bokeh_onload_callbacks.forEach(function(callback) { callback() });\n",
       "    }\n",
       "    finally {\n",
       "      delete root._bokeh_onload_callbacks\n",
       "    }\n",
       "    console.info(\"Bokeh: all callbacks have finished\");\n",
       "  }\n",
       "\n",
       "  function load_libs(js_urls, callback) {\n",
       "    root._bokeh_onload_callbacks.push(callback);\n",
       "    if (root._bokeh_is_loading > 0) {\n",
       "      console.log(\"Bokeh: BokehJS is being loaded, scheduling callback at\", now());\n",
       "      return null;\n",
       "    }\n",
       "    if (js_urls == null || js_urls.length === 0) {\n",
       "      run_callbacks();\n",
       "      return null;\n",
       "    }\n",
       "    console.log(\"Bokeh: BokehJS not loaded, scheduling load and callback at\", now());\n",
       "    root._bokeh_is_loading = js_urls.length;\n",
       "    for (var i = 0; i < js_urls.length; i++) {\n",
       "      var url = js_urls[i];\n",
       "      var s = document.createElement('script');\n",
       "      s.src = url;\n",
       "      s.async = false;\n",
       "      s.onreadystatechange = s.onload = function() {\n",
       "        root._bokeh_is_loading--;\n",
       "        if (root._bokeh_is_loading === 0) {\n",
       "          console.log(\"Bokeh: all BokehJS libraries loaded\");\n",
       "          run_callbacks()\n",
       "        }\n",
       "      };\n",
       "      s.onerror = function() {\n",
       "        console.warn(\"failed to load library \" + url);\n",
       "      };\n",
       "      console.log(\"Bokeh: injecting script tag for BokehJS library: \", url);\n",
       "      document.getElementsByTagName(\"head\")[0].appendChild(s);\n",
       "    }\n",
       "  };var element = document.getElementById(\"fe51ec03-12d8-40da-bd85-7615c8ed6cfb\");\n",
       "  if (element == null) {\n",
       "    console.log(\"Bokeh: ERROR: autoload.js configured with elementid 'fe51ec03-12d8-40da-bd85-7615c8ed6cfb' but no matching script tag was found. \")\n",
       "    return false;\n",
       "  }\n",
       "\n",
       "  var js_urls = [\"https://cdn.pydata.org/bokeh/release/bokeh-0.12.7.min.js\", \"https://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.7.min.js\", \"https://cdn.pydata.org/bokeh/release/bokeh-tables-0.12.7.min.js\", \"https://cdn.pydata.org/bokeh/release/bokeh-gl-0.12.7.min.js\"];\n",
       "\n",
       "  var inline_js = [\n",
       "    function(Bokeh) {\n",
       "      Bokeh.set_log_level(\"info\");\n",
       "    },\n",
       "    \n",
       "    function(Bokeh) {\n",
       "      \n",
       "    },\n",
       "    \n",
       "    function(Bokeh) {\n",
       "      \n",
       "      document.getElementById(\"fe51ec03-12d8-40da-bd85-7615c8ed6cfb\").textContent = \"BokehJS is loading...\";\n",
       "    },\n",
       "    function(Bokeh) {\n",
       "      console.log(\"Bokeh: injecting CSS: https://cdn.pydata.org/bokeh/release/bokeh-0.12.7.min.css\");\n",
       "      Bokeh.embed.inject_css(\"https://cdn.pydata.org/bokeh/release/bokeh-0.12.7.min.css\");\n",
       "      console.log(\"Bokeh: injecting CSS: https://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.7.min.css\");\n",
       "      Bokeh.embed.inject_css(\"https://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.7.min.css\");\n",
       "      console.log(\"Bokeh: injecting CSS: https://cdn.pydata.org/bokeh/release/bokeh-tables-0.12.7.min.css\");\n",
       "      Bokeh.embed.inject_css(\"https://cdn.pydata.org/bokeh/release/bokeh-tables-0.12.7.min.css\");\n",
       "    }\n",
       "  ];\n",
       "\n",
       "  function run_inline_js() {\n",
       "    \n",
       "    if ((root.Bokeh !== undefined) || (force === true)) {\n",
       "      for (var i = 0; i < inline_js.length; i++) {\n",
       "        inline_js[i].call(root, root.Bokeh);\n",
       "      }if (force === true) {\n",
       "        display_loaded();\n",
       "      }} else if (Date.now() < root._bokeh_timeout) {\n",
       "      setTimeout(run_inline_js, 100);\n",
       "    } else if (!root._bokeh_failed_load) {\n",
       "      console.log(\"Bokeh: BokehJS failed to load within specified timeout.\");\n",
       "      root._bokeh_failed_load = true;\n",
       "    } else if (force !== true) {\n",
       "      var cell = $(document.getElementById(\"fe51ec03-12d8-40da-bd85-7615c8ed6cfb\")).parents('.cell').data().cell;\n",
       "      cell.output_area.append_execute_result(NB_LOAD_WARNING)\n",
       "    }\n",
       "\n",
       "  }\n",
       "\n",
       "  if (root._bokeh_is_loading === 0) {\n",
       "    console.log(\"Bokeh: BokehJS loaded, going straight to plotting\");\n",
       "    run_inline_js();\n",
       "  } else {\n",
       "    load_libs(js_urls, function() {\n",
       "      console.log(\"Bokeh: BokehJS plotting callback run at\", now());\n",
       "      run_inline_js();\n",
       "    });\n",
       "  }\n",
       "}(window));"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "import numpy as np\n",
    "from pydgrid.pydgrid import grid\n",
    "from pydgrid.pf import pf_eval,time_serie\n",
    "\n",
    "from bokeh.io import output_notebook, show\n",
    "from bokeh.plotting import figure\n",
    "from bokeh.layouts import gridplot\n",
    "from bokeh.models import ColumnDataSource, HoverTool, CustomJS\n",
    "from bokeh.io import push_notebook\n",
    "from ipywidgets import interact\n",
    "output_notebook()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "import pydgrid"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'0.1.7'"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pydgrid.__version__"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 3 bus 4 wire system with transformer"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Execute power flow "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [],
   "source": [
    "sys1 = grid()\n",
    "sys1.read('sys_3bus_4wire_trafo.json')  # Load data\n",
    "sys1.pf()\n",
    "sys1.pf()         \n",
    "sys1.get_v()      # post process voltages\n",
    "sys1.get_i()      # post process currents"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Graph with obtained results"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "\n",
       "    <div class=\"bk-root\">\n",
       "        <div class=\"bk-plotdiv\" id=\"de5d747f-90af-4814-9ab3-207f8ba04867\"></div>\n",
       "    </div>\n",
       "<script type=\"text/javascript\">\n",
       "  \n",
       "  (function(root) {\n",
       "    function now() {\n",
       "      return new Date();\n",
       "    }\n",
       "  \n",
       "    var force = false;\n",
       "  \n",
       "    if (typeof (root._bokeh_onload_callbacks) === \"undefined\" || force === true) {\n",
       "      root._bokeh_onload_callbacks = [];\n",
       "      root._bokeh_is_loading = undefined;\n",
       "    }\n",
       "  \n",
       "  \n",
       "    \n",
       "    if (typeof (root._bokeh_timeout) === \"undefined\" || force === true) {\n",
       "      root._bokeh_timeout = Date.now() + 0;\n",
       "      root._bokeh_failed_load = false;\n",
       "    }\n",
       "  \n",
       "    var NB_LOAD_WARNING = {'data': {'text/html':\n",
       "       \"<div style='background-color: #fdd'>\\n\"+\n",
       "       \"<p>\\n\"+\n",
       "       \"BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \\n\"+\n",
       "       \"may be due to a slow or bad network connection. Possible fixes:\\n\"+\n",
       "       \"</p>\\n\"+\n",
       "       \"<ul>\\n\"+\n",
       "       \"<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\\n\"+\n",
       "       \"<li>use INLINE resources instead, as so:</li>\\n\"+\n",
       "       \"</ul>\\n\"+\n",
       "       \"<code>\\n\"+\n",
       "       \"from bokeh.resources import INLINE\\n\"+\n",
       "       \"output_notebook(resources=INLINE)\\n\"+\n",
       "       \"</code>\\n\"+\n",
       "       \"</div>\"}};\n",
       "  \n",
       "    function display_loaded() {\n",
       "      if (root.Bokeh !== undefined) {\n",
       "        var el = document.getElementById(\"de5d747f-90af-4814-9ab3-207f8ba04867\");\n",
       "        if (el != null) {\n",
       "          el.textContent = \"BokehJS \" + Bokeh.version + \" successfully loaded.\";\n",
       "        }\n",
       "      } else if (Date.now() < root._bokeh_timeout) {\n",
       "        setTimeout(display_loaded, 100)\n",
       "      }\n",
       "    }\n",
       "  \n",
       "  \n",
       "    function run_callbacks() {\n",
       "      try {\n",
       "        root._bokeh_onload_callbacks.forEach(function(callback) { callback() });\n",
       "      }\n",
       "      finally {\n",
       "        delete root._bokeh_onload_callbacks\n",
       "      }\n",
       "      console.info(\"Bokeh: all callbacks have finished\");\n",
       "    }\n",
       "  \n",
       "    function load_libs(js_urls, callback) {\n",
       "      root._bokeh_onload_callbacks.push(callback);\n",
       "      if (root._bokeh_is_loading > 0) {\n",
       "        console.log(\"Bokeh: BokehJS is being loaded, scheduling callback at\", now());\n",
       "        return null;\n",
       "      }\n",
       "      if (js_urls == null || js_urls.length === 0) {\n",
       "        run_callbacks();\n",
       "        return null;\n",
       "      }\n",
       "      console.log(\"Bokeh: BokehJS not loaded, scheduling load and callback at\", now());\n",
       "      root._bokeh_is_loading = js_urls.length;\n",
       "      for (var i = 0; i < js_urls.length; i++) {\n",
       "        var url = js_urls[i];\n",
       "        var s = document.createElement('script');\n",
       "        s.src = url;\n",
       "        s.async = false;\n",
       "        s.onreadystatechange = s.onload = function() {\n",
       "          root._bokeh_is_loading--;\n",
       "          if (root._bokeh_is_loading === 0) {\n",
       "            console.log(\"Bokeh: all BokehJS libraries loaded\");\n",
       "            run_callbacks()\n",
       "          }\n",
       "        };\n",
       "        s.onerror = function() {\n",
       "          console.warn(\"failed to load library \" + url);\n",
       "        };\n",
       "        console.log(\"Bokeh: injecting script tag for BokehJS library: \", url);\n",
       "        document.getElementsByTagName(\"head\")[0].appendChild(s);\n",
       "      }\n",
       "    };var element = document.getElementById(\"de5d747f-90af-4814-9ab3-207f8ba04867\");\n",
       "    if (element == null) {\n",
       "      console.log(\"Bokeh: ERROR: autoload.js configured with elementid 'de5d747f-90af-4814-9ab3-207f8ba04867' but no matching script tag was found. \")\n",
       "      return false;\n",
       "    }\n",
       "  \n",
       "    var js_urls = [];\n",
       "  \n",
       "    var inline_js = [\n",
       "      function(Bokeh) {\n",
       "        (function() {\n",
       "          var fn = function() {\n",
       "            var docs_json = {\"f4a56514-aff7-4c30-bbb7-6e287b6c9823\":{\"roots\":{\"references\":[{\"attributes\":{\"callback\":null,\"column_names\":[\"x_s\",\"y_s\",\"line_id\",\"i_a_m\",\"i_b_m\",\"i_c_m\",\"i_n_m\",\"deg_a\",\"deg_b\",\"deg_c\",\"deg_n\"],\"data\":{\"deg_a\":[54.64984887934491],\"deg_b\":[-65.35015112065496],\"deg_c\":[174.64984887934517],\"deg_n\":[-153.434948822922],\"i_a_m\":[500.00000000000006],\"i_b_m\":[499.9999999999985],\"i_c_m\":[500.0000000000004],\"i_n_m\":[5.084229945850415e-13],\"line_id\":[\"Bus_1-Bus_2\"],\"x_s\":[[10,200]],\"y_s\":[[0,0]]}},\"id\":\"7153ac6c-90d3-4a4e-8eb2-6bdc5ed5d76f\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"plot\":null,\"text\":\"3 bus 4 wire system with transformer\"},\"id\":\"8f25362d-18d7-496e-a221-bfbe0b87e6bb\",\"type\":\"Title\"},{\"attributes\":{},\"id\":\"318c7801-3f29-490a-9818-afcf52a532fa\",\"type\":\"SaveTool\"},{\"attributes\":{\"plot\":{\"id\":\"ea837f7f-aa0c-4d4b-a183-8d3c808f1363\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"4a975611-4641-45dc-9b02-ce185b3b9887\",\"type\":\"BasicTicker\"}},\"id\":\"de571fcd-41e2-4c20-a086-e45a1222b0ae\",\"type\":\"Grid\"},{\"attributes\":{\"formatter\":{\"id\":\"1da23953-5893-432f-9fdf-b8e8635bdd2d\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"ea837f7f-aa0c-4d4b-a183-8d3c808f1363\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"bcbc5a80-6652-43b7-ade1-e7d3457b05ac\",\"type\":\"BasicTicker\"}},\"id\":\"f5f734b9-c1ab-472c-a912-d81d4e29afba\",\"type\":\"LinearAxis\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"red\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"60026915-66cd-4ce9-9314-a35f3f463b37\",\"type\":\"MultiLine\"},{\"attributes\":{\"formatter\":{\"id\":\"ff58c401-e278-4d05-bba8-0a84fb0bc8dc\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"ea837f7f-aa0c-4d4b-a183-8d3c808f1363\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"4a975611-4641-45dc-9b02-ce185b3b9887\",\"type\":\"BasicTicker\"}},\"id\":\"1e0c3ee8-db34-48b7-817d-8b67eb5bc2f1\",\"type\":\"LinearAxis\"},{\"attributes\":{},\"id\":\"1b4df283-cc25-4077-adcd-a72fede5a3f4\",\"type\":\"WheelZoomTool\"},{\"attributes\":{},\"id\":\"e79b79d9-e685-481e-a7b4-ef47d77682e3\",\"type\":\"ResetTool\"},{\"attributes\":{\"source\":{\"id\":\"95fd272e-32cf-47b2-b058-67dce963a26c\",\"type\":\"ColumnDataSource\"}},\"id\":\"89eee1c6-baa7-465c-a7f3-b0d5be0dae5b\",\"type\":\"CDSView\"},{\"attributes\":{\"data_source\":{\"id\":\"95fd272e-32cf-47b2-b058-67dce963a26c\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"7031eae6-8359-4d25-9122-f675ee036a1a\",\"type\":\"Circle\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"ae5fa41a-d9da-47d2-bfa1-3dd02e09582a\",\"type\":\"Circle\"},\"selection_glyph\":null,\"view\":{\"id\":\"89eee1c6-baa7-465c-a7f3-b0d5be0dae5b\",\"type\":\"CDSView\"}},\"id\":\"e4ecc997-331a-46b2-84b3-8c804a0b171d\",\"type\":\"GlyphRenderer\"},{\"attributes\":{},\"id\":\"48f71267-d432-4170-afb9-827d4a56db65\",\"type\":\"PanTool\"},{\"attributes\":{},\"id\":\"3ec4112b-ba65-4f18-a32f-87cf5d720fc9\",\"type\":\"HelpTool\"},{\"attributes\":{},\"id\":\"1da23953-5893-432f-9fdf-b8e8635bdd2d\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{},\"id\":\"4a975611-4641-45dc-9b02-ce185b3b9887\",\"type\":\"BasicTicker\"},{\"attributes\":{},\"id\":\"ff58c401-e278-4d05-bba8-0a84fb0bc8dc\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"e4ecc997-331a-46b2-84b3-8c804a0b171d\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            bus_id = @bus_id \\n            <table border=\\\"1\\\">\\n                <tr>\\n                <td>v<sub>an</sub> =  @v_an  &ang; @deg_an V </td> <td> S<sub>a</sub> = @p_a + j@q_a </td>\\n                </tr>\\n                      <tr>\\n                      <td> </td> <td>v<sub>ab</sub>= @v_ab V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>bn</sub> = @v_bn &ang; @deg_bn V </td><td> S<sub>b</sub> = @p_b + j@q_b </td>\\n                </tr>\\n                      <tr>\\n                      <td> </td><td>v<sub>bc</sub>= @v_bc V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>cn</sub>  = @v_cn &ang; @deg_cn V </td>  <td>S<sub>c</sub> = @p_c + j@q_c </td>\\n                </tr> \\n                    <tr>\\n                     <td> </td> <td>v<sub>ca</sub>= @v_ca V</td>\\n                    </tr>\\n               <tr>\\n                <td>v<sub>ng</sub>    = @v_ng &ang; @deg_ng V</td>  <td>S<sub>abc</sub> = @p_abc + j@q_abc </td>\\n              </tr>\\n            </table>\\n            </div>\\n            \"},\"id\":\"bc31331c-9045-4130-b837-b54399701069\",\"type\":\"HoverTool\"},{\"attributes\":{},\"id\":\"bcbc5a80-6652-43b7-ade1-e7d3457b05ac\",\"type\":\"BasicTicker\"},{\"attributes\":{\"source\":{\"id\":\"7153ac6c-90d3-4a4e-8eb2-6bdc5ed5d76f\",\"type\":\"ColumnDataSource\"}},\"id\":\"d0902ed5-f90b-43c0-9412-45629de44de2\",\"type\":\"CDSView\"},{\"attributes\":{\"callback\":null},\"id\":\"60e685d5-9c82-418a-b066-f8b509322459\",\"type\":\"DataRange1d\"},{\"attributes\":{\"callback\":null},\"id\":\"a5e22330-d3b4-4057-b7af-da02a85587f1\",\"type\":\"DataRange1d\"},{\"attributes\":{\"dimension\":1,\"plot\":{\"id\":\"ea837f7f-aa0c-4d4b-a183-8d3c808f1363\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"bcbc5a80-6652-43b7-ade1-e7d3457b05ac\",\"type\":\"BasicTicker\"}},\"id\":\"96fe882e-1fbf-4d11-8832-edd76e177f62\",\"type\":\"Grid\"},{\"attributes\":{\"below\":[{\"id\":\"1e0c3ee8-db34-48b7-817d-8b67eb5bc2f1\",\"type\":\"LinearAxis\"}],\"left\":[{\"id\":\"f5f734b9-c1ab-472c-a912-d81d4e29afba\",\"type\":\"LinearAxis\"}],\"plot_height\":200,\"renderers\":[{\"id\":\"1e0c3ee8-db34-48b7-817d-8b67eb5bc2f1\",\"type\":\"LinearAxis\"},{\"id\":\"de571fcd-41e2-4c20-a086-e45a1222b0ae\",\"type\":\"Grid\"},{\"id\":\"f5f734b9-c1ab-472c-a912-d81d4e29afba\",\"type\":\"LinearAxis\"},{\"id\":\"96fe882e-1fbf-4d11-8832-edd76e177f62\",\"type\":\"Grid\"},{\"id\":\"b20501f5-60f9-47e9-afd5-f71a92a05968\",\"type\":\"BoxAnnotation\"},{\"id\":\"3237d5cc-4bb4-4a1e-934b-88fd67e8b151\",\"type\":\"GlyphRenderer\"},{\"id\":\"e4ecc997-331a-46b2-84b3-8c804a0b171d\",\"type\":\"GlyphRenderer\"}],\"title\":{\"id\":\"8f25362d-18d7-496e-a221-bfbe0b87e6bb\",\"type\":\"Title\"},\"toolbar\":{\"id\":\"060f62c0-cdcc-4005-b5c5-de66b28a54f1\",\"type\":\"Toolbar\"},\"x_range\":{\"id\":\"a5e22330-d3b4-4057-b7af-da02a85587f1\",\"type\":\"DataRange1d\"},\"x_scale\":{\"id\":\"a6cb6023-7971-4c36-974e-c43e97929bda\",\"type\":\"LinearScale\"},\"y_range\":{\"id\":\"60e685d5-9c82-418a-b066-f8b509322459\",\"type\":\"DataRange1d\"},\"y_scale\":{\"id\":\"2ad33e10-570d-44ce-aba1-60227e659367\",\"type\":\"LinearScale\"}},\"id\":\"ea837f7f-aa0c-4d4b-a183-8d3c808f1363\",\"subtype\":\"Figure\",\"type\":\"Plot\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"3237d5cc-4bb4-4a1e-934b-88fd67e8b151\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            line id = @line_id \\n            <table border=\\\"1\\\">\\n                <tr>\\n                <td>I<sub>a</sub> =  @i_a_m &ang; @deg_a </td>\\n                </tr>\\n                <tr>\\n                <td>I<sub>b</sub> =  @i_b_m &ang; @deg_b </td>\\n                </tr>\\n                <tr>\\n                <td>I<sub>c</sub> =  @i_c_m &ang; @deg_c </td>\\n                </tr>\\n                <tr>\\n                <td>I<sub>n</sub> =  @i_n_m &ang; @deg_n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"c458a022-b10b-44b8-a384-bbfef9cf04bf\",\"type\":\"HoverTool\"},{\"attributes\":{\"bottom_units\":\"screen\",\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"lightgrey\"},\"left_units\":\"screen\",\"level\":\"overlay\",\"line_alpha\":{\"value\":1.0},\"line_color\":{\"value\":\"black\"},\"line_dash\":[4,4],\"line_width\":{\"value\":2},\"plot\":null,\"render_mode\":\"css\",\"right_units\":\"screen\",\"top_units\":\"screen\"},\"id\":\"b20501f5-60f9-47e9-afd5-f71a92a05968\",\"type\":\"BoxAnnotation\"},{\"attributes\":{\"active_drag\":\"auto\",\"active_inspect\":\"auto\",\"active_scroll\":\"auto\",\"active_tap\":\"auto\",\"tools\":[{\"id\":\"48f71267-d432-4170-afb9-827d4a56db65\",\"type\":\"PanTool\"},{\"id\":\"1b4df283-cc25-4077-adcd-a72fede5a3f4\",\"type\":\"WheelZoomTool\"},{\"id\":\"b18555f8-2ff4-48ec-bf9c-cac1c4a356f9\",\"type\":\"BoxZoomTool\"},{\"id\":\"318c7801-3f29-490a-9818-afcf52a532fa\",\"type\":\"SaveTool\"},{\"id\":\"e79b79d9-e685-481e-a7b4-ef47d77682e3\",\"type\":\"ResetTool\"},{\"id\":\"3ec4112b-ba65-4f18-a32f-87cf5d720fc9\",\"type\":\"HelpTool\"},{\"id\":\"c458a022-b10b-44b8-a384-bbfef9cf04bf\",\"type\":\"HoverTool\"},{\"id\":\"bc31331c-9045-4130-b837-b54399701069\",\"type\":\"HoverTool\"}]},\"id\":\"060f62c0-cdcc-4005-b5c5-de66b28a54f1\",\"type\":\"Toolbar\"},{\"attributes\":{},\"id\":\"2ad33e10-570d-44ce-aba1-60227e659367\",\"type\":\"LinearScale\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"6efdfc96-0e9d-443a-ad5a-dc88325926fb\",\"type\":\"MultiLine\"},{\"attributes\":{\"data_source\":{\"id\":\"7153ac6c-90d3-4a4e-8eb2-6bdc5ed5d76f\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"60026915-66cd-4ce9-9314-a35f3f463b37\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"6efdfc96-0e9d-443a-ad5a-dc88325926fb\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"d0902ed5-f90b-43c0-9412-45629de44de2\",\"type\":\"CDSView\"}},\"id\":\"3237d5cc-4bb4-4a1e-934b-88fd67e8b151\",\"type\":\"GlyphRenderer\"},{\"attributes\":{\"callback\":null,\"column_names\":[\"x\",\"y\",\"bus_id\",\"v_an\",\"v_bn\",\"v_cn\",\"v_ng\",\"deg_an\",\"deg_bn\",\"deg_cn\",\"deg_ng\",\"v_ab\",\"v_bc\",\"v_ca\",\"p_a\",\"p_b\",\"p_c\",\"q_a\",\"q_b\",\"q_c\",\"p_abc\",\"q_abc\",\"s_radio\",\"s_color\"],\"data\":{\"bus_id\":[\"Bus_0\",\"Bus_1\",\"Bus_2\"],\"deg_an\":[\"0.00\",\"-31.66\",\"-35.35\"],\"deg_bn\":[\"-120.00\",\"-151.66\",\"-155.35\"],\"deg_cn\":[\"120.00\",\"88.34\",\"84.65\"],\"deg_ng\":[\"0.00\",\"-143.13\",\"-44.79\"],\"p_a\":[\"10.77\",\"0.00\",\"0.00\"],\"p_abc\":[\"32.30\",\"0.00\",\"0.00\"],\"p_b\":[\"10.77\",\"-0.00\",\"0.00\"],\"p_c\":[\"10.77\",\"0.00\",\"0.00\"],\"q_a\":[\"-114.97\",\"-0.00\",\"129.70\"],\"q_abc\":[\"-344.90\",\"0.00\",\"389.10\"],\"q_b\":[\"-114.97\",\"0.00\",\"129.70\"],\"q_c\":[\"-114.97\",\"0.00\",\"129.70\"],\"s_color\":[\"red\",\"blue\",\"red\"],\"s_radio\":[10,10,10],\"v_ab\":[19999.99067499782,436.1112131313212,449.2891904378341],\"v_an\":[\"11547.00\",\"251.79\",\"259.40\"],\"v_bc\":[19999.990674997825,436.11121313132105,449.28919043783407],\"v_bn\":[\"11547.00\",\"251.79\",\"259.40\"],\"v_ca\":[19999.99067499783,436.11121313132105,449.289190437834],\"v_cn\":[\"11547.00\",\"251.79\",\"259.40\"],\"v_ng\":[\"0.00\",\"0.00\",\"0.00\"],\"x\":[0,10,200],\"y\":[0,0,0]}},\"id\":\"95fd272e-32cf-47b2-b058-67dce963a26c\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"navy\"},\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"navy\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"7031eae6-8359-4d25-9122-f675ee036a1a\",\"type\":\"Circle\"},{\"attributes\":{\"overlay\":{\"id\":\"b20501f5-60f9-47e9-afd5-f71a92a05968\",\"type\":\"BoxAnnotation\"}},\"id\":\"b18555f8-2ff4-48ec-bf9c-cac1c4a356f9\",\"type\":\"BoxZoomTool\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.1},\"fill_color\":{\"value\":\"#1f77b4\"},\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"ae5fa41a-d9da-47d2-bfa1-3dd02e09582a\",\"type\":\"Circle\"},{\"attributes\":{},\"id\":\"a6cb6023-7971-4c36-974e-c43e97929bda\",\"type\":\"LinearScale\"}],\"root_ids\":[\"ea837f7f-aa0c-4d4b-a183-8d3c808f1363\"]},\"title\":\"Bokeh Application\",\"version\":\"0.12.7\"}};\n",
       "            var render_items = [{\"docid\":\"f4a56514-aff7-4c30-bbb7-6e287b6c9823\",\"elementid\":\"de5d747f-90af-4814-9ab3-207f8ba04867\",\"modelid\":\"ea837f7f-aa0c-4d4b-a183-8d3c808f1363\"}];\n",
       "            \n",
       "            Bokeh.embed.embed_items(docs_json, render_items);\n",
       "          };\n",
       "          if (document.readyState != \"loading\") fn();\n",
       "          else document.addEventListener(\"DOMContentLoaded\", fn);\n",
       "        })();\n",
       "      },\n",
       "      function(Bokeh) {\n",
       "      }\n",
       "    ];\n",
       "  \n",
       "    function run_inline_js() {\n",
       "      \n",
       "      if ((root.Bokeh !== undefined) || (force === true)) {\n",
       "        for (var i = 0; i < inline_js.length; i++) {\n",
       "          inline_js[i].call(root, root.Bokeh);\n",
       "        }if (force === true) {\n",
       "          display_loaded();\n",
       "        }} else if (Date.now() < root._bokeh_timeout) {\n",
       "        setTimeout(run_inline_js, 100);\n",
       "      } else if (!root._bokeh_failed_load) {\n",
       "        console.log(\"Bokeh: BokehJS failed to load within specified timeout.\");\n",
       "        root._bokeh_failed_load = true;\n",
       "      } else if (force !== true) {\n",
       "        var cell = $(document.getElementById(\"de5d747f-90af-4814-9ab3-207f8ba04867\")).parents('.cell').data().cell;\n",
       "        cell.output_area.append_execute_result(NB_LOAD_WARNING)\n",
       "      }\n",
       "  \n",
       "    }\n",
       "  \n",
       "    if (root._bokeh_is_loading === 0) {\n",
       "      console.log(\"Bokeh: BokehJS loaded, going straight to plotting\");\n",
       "      run_inline_js();\n",
       "    } else {\n",
       "      load_libs(js_urls, function() {\n",
       "        console.log(\"Bokeh: BokehJS plotting callback run at\", now());\n",
       "        run_inline_js();\n",
       "      });\n",
       "    }\n",
       "  }(window));\n",
       "</script>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "sys1.bokeh_tools()\n",
    "\n",
    "p = figure(width=600, height=200,\n",
    "           title='3 bus 4 wire system with transformer') #, x_range=[-200,200], y_range=[-350, 50])\n",
    "\n",
    "# lines:\n",
    "source = ColumnDataSource(sys1.line_data)\n",
    "lin = p.multi_line(source=source, xs='x_s', ys='y_s', color=\"red\", alpha=0.5, line_width=5)\n",
    "\n",
    "# buses:\n",
    "source = ColumnDataSource(sys1.bus_data)\n",
    "cr = p.circle(source=source, x='x', y='y', size=15, color=\"navy\", alpha=0.5)\n",
    "\n",
    "p.add_tools(HoverTool(renderers=[lin], tooltips=sys1.line_tooltip))\n",
    "p.add_tools(HoverTool(renderers=[cr], tooltips=sys1.bus_tooltip))\n",
    "show(p)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Get element transfomers results"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[{'R_cc_pu': 0.01,\n",
       "  'S_n_kVA': 150.0,\n",
       "  'U_1_kV': 20.0,\n",
       "  'U_2_kV': 0.4,\n",
       "  'X_cc_pu': 0.04,\n",
       "  'bus_j': 'Bus_0',\n",
       "  'bus_j_nodes': [1, 2, 3],\n",
       "  'bus_k': 'Bus_1',\n",
       "  'bus_k_nodes': [1, 2, 3, 4],\n",
       "  'conductors_1': 3,\n",
       "  'conductors_2': 4,\n",
       "  'connection': 'Dyn11',\n",
       "  'deg_1a': 84.649848879345072,\n",
       "  'deg_1b': -35.35015112065512,\n",
       "  'deg_1c': -155.35015112065494,\n",
       "  'deg_1n': 90.0,\n",
       "  'deg_2a': -125.3501511206549,\n",
       "  'deg_2b': 114.64984887934516,\n",
       "  'deg_2c': -5.3501511206549273,\n",
       "  'deg_2n': -33.690067525979785,\n",
       "  'i_1a_m': 10.000000000000014,\n",
       "  'i_1b_m': 9.9999999999999751,\n",
       "  'i_1c_m': 9.9999999999999556,\n",
       "  'i_1n_m': 2.1316282072803006e-14,\n",
       "  'i_2a_m': 499.99999999999989,\n",
       "  'i_2b_m': 500.00000000000097,\n",
       "  'i_2c_m': 499.99999999999932,\n",
       "  'i_2n_m': 1.6396148910025609e-12}]"
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sys1.transformers"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "anaconda-cloud": {},
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 1
}
