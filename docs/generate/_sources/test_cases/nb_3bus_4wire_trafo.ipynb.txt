{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "    <div class=\"bk-root\">\n",
       "        <a href=\"https://bokeh.pydata.org\" target=\"_blank\" class=\"bk-logo bk-logo-small bk-logo-notebook\"></a>\n",
       "        <span id=\"e373c0d9-cf7d-4ca1-97a3-d096497005db\">Loading BokehJS ...</span>\n",
       "    </div>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/javascript": [
       "\n",
       "(function(root) {\n",
       "  function now() {\n",
       "    return new Date();\n",
       "  }\n",
       "\n",
       "  var force = true;\n",
       "\n",
       "  if (typeof (root._bokeh_onload_callbacks) === \"undefined\" || force === true) {\n",
       "    root._bokeh_onload_callbacks = [];\n",
       "    root._bokeh_is_loading = undefined;\n",
       "  }\n",
       "\n",
       "\n",
       "  \n",
       "  if (typeof (root._bokeh_timeout) === \"undefined\" || force === true) {\n",
       "    root._bokeh_timeout = Date.now() + 5000;\n",
       "    root._bokeh_failed_load = false;\n",
       "  }\n",
       "\n",
       "  var NB_LOAD_WARNING = {'data': {'text/html':\n",
       "     \"<div style='background-color: #fdd'>\\n\"+\n",
       "     \"<p>\\n\"+\n",
       "     \"BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \\n\"+\n",
       "     \"may be due to a slow or bad network connection. Possible fixes:\\n\"+\n",
       "     \"</p>\\n\"+\n",
       "     \"<ul>\\n\"+\n",
       "     \"<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\\n\"+\n",
       "     \"<li>use INLINE resources instead, as so:</li>\\n\"+\n",
       "     \"</ul>\\n\"+\n",
       "     \"<code>\\n\"+\n",
       "     \"from bokeh.resources import INLINE\\n\"+\n",
       "     \"output_notebook(resources=INLINE)\\n\"+\n",
       "     \"</code>\\n\"+\n",
       "     \"</div>\"}};\n",
       "\n",
       "  function display_loaded() {\n",
       "    if (root.Bokeh !== undefined) {\n",
       "      var el = document.getElementById(\"e373c0d9-cf7d-4ca1-97a3-d096497005db\");\n",
       "      if (el != null) {\n",
       "        el.textContent = \"BokehJS \" + Bokeh.version + \" successfully loaded.\";\n",
       "      }\n",
       "    } else if (Date.now() < root._bokeh_timeout) {\n",
       "      setTimeout(display_loaded, 100)\n",
       "    }\n",
       "  }\n",
       "\n",
       "\n",
       "  function run_callbacks() {\n",
       "    try {\n",
       "      root._bokeh_onload_callbacks.forEach(function(callback) { callback() });\n",
       "    }\n",
       "    finally {\n",
       "      delete root._bokeh_onload_callbacks\n",
       "    }\n",
       "    console.info(\"Bokeh: all callbacks have finished\");\n",
       "  }\n",
       "\n",
       "  function load_libs(js_urls, callback) {\n",
       "    root._bokeh_onload_callbacks.push(callback);\n",
       "    if (root._bokeh_is_loading > 0) {\n",
       "      console.log(\"Bokeh: BokehJS is being loaded, scheduling callback at\", now());\n",
       "      return null;\n",
       "    }\n",
       "    if (js_urls == null || js_urls.length === 0) {\n",
       "      run_callbacks();\n",
       "      return null;\n",
       "    }\n",
       "    console.log(\"Bokeh: BokehJS not loaded, scheduling load and callback at\", now());\n",
       "    root._bokeh_is_loading = js_urls.length;\n",
       "    for (var i = 0; i < js_urls.length; i++) {\n",
       "      var url = js_urls[i];\n",
       "      var s = document.createElement('script');\n",
       "      s.src = url;\n",
       "      s.async = false;\n",
       "      s.onreadystatechange = s.onload = function() {\n",
       "        root._bokeh_is_loading--;\n",
       "        if (root._bokeh_is_loading === 0) {\n",
       "          console.log(\"Bokeh: all BokehJS libraries loaded\");\n",
       "          run_callbacks()\n",
       "        }\n",
       "      };\n",
       "      s.onerror = function() {\n",
       "        console.warn(\"failed to load library \" + url);\n",
       "      };\n",
       "      console.log(\"Bokeh: injecting script tag for BokehJS library: \", url);\n",
       "      document.getElementsByTagName(\"head\")[0].appendChild(s);\n",
       "    }\n",
       "  };var element = document.getElementById(\"e373c0d9-cf7d-4ca1-97a3-d096497005db\");\n",
       "  if (element == null) {\n",
       "    console.log(\"Bokeh: ERROR: autoload.js configured with elementid 'e373c0d9-cf7d-4ca1-97a3-d096497005db' but no matching script tag was found. \")\n",
       "    return false;\n",
       "  }\n",
       "\n",
       "  var js_urls = [\"https://cdn.pydata.org/bokeh/release/bokeh-0.12.7.min.js\", \"https://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.7.min.js\", \"https://cdn.pydata.org/bokeh/release/bokeh-tables-0.12.7.min.js\", \"https://cdn.pydata.org/bokeh/release/bokeh-gl-0.12.7.min.js\"];\n",
       "\n",
       "  var inline_js = [\n",
       "    function(Bokeh) {\n",
       "      Bokeh.set_log_level(\"info\");\n",
       "    },\n",
       "    \n",
       "    function(Bokeh) {\n",
       "      \n",
       "    },\n",
       "    \n",
       "    function(Bokeh) {\n",
       "      \n",
       "      document.getElementById(\"e373c0d9-cf7d-4ca1-97a3-d096497005db\").textContent = \"BokehJS is loading...\";\n",
       "    },\n",
       "    function(Bokeh) {\n",
       "      console.log(\"Bokeh: injecting CSS: https://cdn.pydata.org/bokeh/release/bokeh-0.12.7.min.css\");\n",
       "      Bokeh.embed.inject_css(\"https://cdn.pydata.org/bokeh/release/bokeh-0.12.7.min.css\");\n",
       "      console.log(\"Bokeh: injecting CSS: https://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.7.min.css\");\n",
       "      Bokeh.embed.inject_css(\"https://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.7.min.css\");\n",
       "      console.log(\"Bokeh: injecting CSS: https://cdn.pydata.org/bokeh/release/bokeh-tables-0.12.7.min.css\");\n",
       "      Bokeh.embed.inject_css(\"https://cdn.pydata.org/bokeh/release/bokeh-tables-0.12.7.min.css\");\n",
       "    }\n",
       "  ];\n",
       "\n",
       "  function run_inline_js() {\n",
       "    \n",
       "    if ((root.Bokeh !== undefined) || (force === true)) {\n",
       "      for (var i = 0; i < inline_js.length; i++) {\n",
       "        inline_js[i].call(root, root.Bokeh);\n",
       "      }if (force === true) {\n",
       "        display_loaded();\n",
       "      }} else if (Date.now() < root._bokeh_timeout) {\n",
       "      setTimeout(run_inline_js, 100);\n",
       "    } else if (!root._bokeh_failed_load) {\n",
       "      console.log(\"Bokeh: BokehJS failed to load within specified timeout.\");\n",
       "      root._bokeh_failed_load = true;\n",
       "    } else if (force !== true) {\n",
       "      var cell = $(document.getElementById(\"e373c0d9-cf7d-4ca1-97a3-d096497005db\")).parents('.cell').data().cell;\n",
       "      cell.output_area.append_execute_result(NB_LOAD_WARNING)\n",
       "    }\n",
       "\n",
       "  }\n",
       "\n",
       "  if (root._bokeh_is_loading === 0) {\n",
       "    console.log(\"Bokeh: BokehJS loaded, going straight to plotting\");\n",
       "    run_inline_js();\n",
       "  } else {\n",
       "    load_libs(js_urls, function() {\n",
       "      console.log(\"Bokeh: BokehJS plotting callback run at\", now());\n",
       "      run_inline_js();\n",
       "    });\n",
       "  }\n",
       "}(window));"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "import numpy as np\n",
    "from pydgrid.pydgrid import grid\n",
    "from pydgrid.pf import pf_eval,time_serie\n",
    "\n",
    "from bokeh.io import output_notebook, show\n",
    "from bokeh.plotting import figure\n",
    "from bokeh.models import ColumnDataSource, HoverTool\n",
    "from bokeh.io import push_notebook\n",
    "output_notebook()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 3 bus 4 wire system with transformer"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Data"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "data = {\n",
    "\"transformers\":[\n",
    "        {\"bus_j\": \"Bus_0\",  \"bus_k\": \"Bus_1\",  \"S_n_kVA\": 150.0, \"U_1_kV\":20.0, \"U_2_kV\":0.4,\n",
    "        \"R_cc_pu\": 0.01, \"X_cc_pu\":0.04, \"connection\": \"Dyn11\", \n",
    "        \"conductors_1\": 3, \"conductors_2\": 4}\n",
    "        ],\n",
    "\"lines\":[\n",
    "        {\"bus_j\": \"Bus_1\",  \"bus_k\": \"Bus_2\",  \"code\": \"UG1\", \"m\": 200.0}\n",
    "        ],\n",
    "\"buses\":[\n",
    "        {\"bus\": \"Bus_0\",  \"pos_x\": 0,  \"pos_y\": 0, \"units\": \"m\", \"U_kV\":20.0},\n",
    "        {\"bus\": \"Bus_1\",  \"pos_x\":10,  \"pos_y\": 0, \"units\": \"m\", \"U_kV\":0.4},\n",
    "        {\"bus\": \"Bus_2\",  \"pos_x\":200, \"pos_y\": 0, \"units\": \"m\", \"U_kV\":0.4}\n",
    "        ],\n",
    "\"grid_formers\":[\n",
    "        {\"bus\": \"Bus_0\",\n",
    "        \"bus_nodes\": [1, 2, 3], \"deg\": [0, -120, -240], \n",
    "        \"kV\": [11.547, 11.547, 11.547]}\n",
    "        ],\n",
    "\"grid_feeders\":[{\"bus\": \"Bus_2\",\"bus_nodes\": [1, 2, 3, 4],\n",
    "                \"kW\": [0, 0, 0], \"kvar\": [0,0,0],\n",
    "                \"kA\": [0.5,0.5,0.5], \"phi_deg\":[30, 30, 30]}\n",
    "                ],\n",
    "\"shunts\":[\n",
    "        {\"bus\": \"Bus_1\" , \"R\": 0.0001, \"X\": 0.0, \"bus_nodes\": [4,0]},\n",
    "        {\"bus\": \"Bus_2\" , \"R\": 0.0001, \"X\": 0.0, \"bus_nodes\": [4,0]}\n",
    "        ]\n",
    "}"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Execute power flow "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "sys1 = grid()\n",
    "sys1.read(data)  # Load data\n",
    "\n",
    "sys1.pf()  # solve power flow\n",
    "        \n",
    "sys1.get_v()      # post process voltages\n",
    "sys1.get_i()      # post process currents"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Graph with obtained results"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "\n",
       "    <div class=\"bk-root\">\n",
       "        <div class=\"bk-plotdiv\" id=\"dda60240-c6fd-47ce-b044-031b9d82b5c1\"></div>\n",
       "    </div>\n",
       "<script type=\"text/javascript\">\n",
       "  \n",
       "  (function(root) {\n",
       "    function now() {\n",
       "      return new Date();\n",
       "    }\n",
       "  \n",
       "    var force = false;\n",
       "  \n",
       "    if (typeof (root._bokeh_onload_callbacks) === \"undefined\" || force === true) {\n",
       "      root._bokeh_onload_callbacks = [];\n",
       "      root._bokeh_is_loading = undefined;\n",
       "    }\n",
       "  \n",
       "  \n",
       "    \n",
       "    if (typeof (root._bokeh_timeout) === \"undefined\" || force === true) {\n",
       "      root._bokeh_timeout = Date.now() + 0;\n",
       "      root._bokeh_failed_load = false;\n",
       "    }\n",
       "  \n",
       "    var NB_LOAD_WARNING = {'data': {'text/html':\n",
       "       \"<div style='background-color: #fdd'>\\n\"+\n",
       "       \"<p>\\n\"+\n",
       "       \"BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \\n\"+\n",
       "       \"may be due to a slow or bad network connection. Possible fixes:\\n\"+\n",
       "       \"</p>\\n\"+\n",
       "       \"<ul>\\n\"+\n",
       "       \"<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\\n\"+\n",
       "       \"<li>use INLINE resources instead, as so:</li>\\n\"+\n",
       "       \"</ul>\\n\"+\n",
       "       \"<code>\\n\"+\n",
       "       \"from bokeh.resources import INLINE\\n\"+\n",
       "       \"output_notebook(resources=INLINE)\\n\"+\n",
       "       \"</code>\\n\"+\n",
       "       \"</div>\"}};\n",
       "  \n",
       "    function display_loaded() {\n",
       "      if (root.Bokeh !== undefined) {\n",
       "        var el = document.getElementById(\"dda60240-c6fd-47ce-b044-031b9d82b5c1\");\n",
       "        if (el != null) {\n",
       "          el.textContent = \"BokehJS \" + Bokeh.version + \" successfully loaded.\";\n",
       "        }\n",
       "      } else if (Date.now() < root._bokeh_timeout) {\n",
       "        setTimeout(display_loaded, 100)\n",
       "      }\n",
       "    }\n",
       "  \n",
       "  \n",
       "    function run_callbacks() {\n",
       "      try {\n",
       "        root._bokeh_onload_callbacks.forEach(function(callback) { callback() });\n",
       "      }\n",
       "      finally {\n",
       "        delete root._bokeh_onload_callbacks\n",
       "      }\n",
       "      console.info(\"Bokeh: all callbacks have finished\");\n",
       "    }\n",
       "  \n",
       "    function load_libs(js_urls, callback) {\n",
       "      root._bokeh_onload_callbacks.push(callback);\n",
       "      if (root._bokeh_is_loading > 0) {\n",
       "        console.log(\"Bokeh: BokehJS is being loaded, scheduling callback at\", now());\n",
       "        return null;\n",
       "      }\n",
       "      if (js_urls == null || js_urls.length === 0) {\n",
       "        run_callbacks();\n",
       "        return null;\n",
       "      }\n",
       "      console.log(\"Bokeh: BokehJS not loaded, scheduling load and callback at\", now());\n",
       "      root._bokeh_is_loading = js_urls.length;\n",
       "      for (var i = 0; i < js_urls.length; i++) {\n",
       "        var url = js_urls[i];\n",
       "        var s = document.createElement('script');\n",
       "        s.src = url;\n",
       "        s.async = false;\n",
       "        s.onreadystatechange = s.onload = function() {\n",
       "          root._bokeh_is_loading--;\n",
       "          if (root._bokeh_is_loading === 0) {\n",
       "            console.log(\"Bokeh: all BokehJS libraries loaded\");\n",
       "            run_callbacks()\n",
       "          }\n",
       "        };\n",
       "        s.onerror = function() {\n",
       "          console.warn(\"failed to load library \" + url);\n",
       "        };\n",
       "        console.log(\"Bokeh: injecting script tag for BokehJS library: \", url);\n",
       "        document.getElementsByTagName(\"head\")[0].appendChild(s);\n",
       "      }\n",
       "    };var element = document.getElementById(\"dda60240-c6fd-47ce-b044-031b9d82b5c1\");\n",
       "    if (element == null) {\n",
       "      console.log(\"Bokeh: ERROR: autoload.js configured with elementid 'dda60240-c6fd-47ce-b044-031b9d82b5c1' but no matching script tag was found. \")\n",
       "      return false;\n",
       "    }\n",
       "  \n",
       "    var js_urls = [];\n",
       "  \n",
       "    var inline_js = [\n",
       "      function(Bokeh) {\n",
       "        (function() {\n",
       "          var fn = function() {\n",
       "            var docs_json = {\"b702c0d1-6af4-49ec-a98e-6dec60c19f29\":{\"roots\":{\"references\":[{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"64d82f9a-fb44-4be4-a8ed-5ab71966890c\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1067803d-ec55-48d7-9304-1742721d9606\",\"type\":\"PanTool\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"red\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"d40b1035-6040-428f-b47c-2ad8ddc664b8\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"2adba0ee-a342-4159-9ab6-e822a87a3d28\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{},\"id\":\"42446f4c-c75c-4685-8c56-89834cea4674\",\"type\":\"WheelZoomTool\"},{\"attributes\":{\"overlay\":{\"id\":\"4328a163-abb1-40cc-8ecb-0c022752413c\",\"type\":\"BoxAnnotation\"}},\"id\":\"f690873f-21f2-43f2-9335-dccaf06e6ddb\",\"type\":\"BoxZoomTool\"},{\"attributes\":{},\"id\":\"f280bcef-7fe4-4557-8d48-98c5e75c3a60\",\"type\":\"SaveTool\"},{\"attributes\":{},\"id\":\"08549134-19cf-4b16-92c5-8c7330c93193\",\"type\":\"ResetTool\"},{\"attributes\":{},\"id\":\"5b4dc7c8-9732-4743-bec6-4017dfcdd5bd\",\"type\":\"HelpTool\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"b2d814b2-3c86-4cbf-b175-69d25c6a882b\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            bus_id = @bus_id \\n            <table border=\\\"1\\\">\\n                <tr>\\n                <td>v<sub>an</sub> =  @v_an  &ang; @deg_an V </td> <td> S<sub>a</sub> = @p_a + j@q_a </td>\\n                </tr>\\n                      <tr>\\n                      <td> </td> <td>v<sub>ab</sub>= @v_ab V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>bn</sub> = @v_bn &ang; @deg_bn V </td><td> S<sub>b</sub> = @p_b + j@q_b </td>\\n                </tr>\\n                      <tr>\\n                      <td> </td><td>v<sub>bc</sub>= @v_bc V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>cn</sub>  = @v_cn &ang; @deg_cn V </td>  <td>S<sub>c</sub> = @p_c + j@q_c </td>\\n                </tr> \\n                    <tr>\\n                     <td> </td> <td>v<sub>ca</sub>= @v_ca V</td>\\n                    </tr>\\n               <tr>\\n                <td>v<sub>ng</sub>    = @v_ng &ang; @deg_ng V</td>  <td>S<sub>abc</sub> = @p_abc + j@q_abc </td>\\n              </tr>\\n            </table>\\n            </div>\\n            \"},\"id\":\"7c22d503-7177-4917-a2f3-0e41c93b9a18\",\"type\":\"HoverTool\"},{\"attributes\":{\"callback\":null,\"column_names\":[\"x\",\"y\",\"bus_id\",\"v_an\",\"v_bn\",\"v_cn\",\"v_ng\",\"deg_an\",\"deg_bn\",\"deg_cn\",\"deg_ng\",\"v_ab\",\"v_bc\",\"v_ca\",\"p_a\",\"p_b\",\"p_c\",\"q_a\",\"q_b\",\"q_c\",\"p_abc\",\"q_abc\",\"s_radio\",\"s_color\"],\"data\":{\"bus_id\":[\"Bus_0\",\"Bus_1\",\"Bus_2\"],\"deg_an\":[\"0.00\",\"-24.88\",\"-20.49\"],\"deg_bn\":[\"-120.00\",\"-144.87\",\"-140.83\"],\"deg_cn\":[\"120.00\",\"95.16\",\"98.41\"],\"deg_ng\":[\"0.00\",\"-87.08\",\"92.92\"],\"p_a\":[\"-89.46\",\"0.00\",\"101.74\"],\"p_abc\":[\"-269.10\",\"0.00\",\"301.41\"],\"p_b\":[\"-90.35\",\"-0.00\",\"99.99\"],\"p_c\":[\"-89.29\",\"0.00\",\"99.69\"],\"q_a\":[\"73.32\",\"-0.00\",\"-58.74\"],\"q_abc\":[\"218.13\",\"0.00\",\"-174.02\"],\"q_b\":[\"72.61\",\"0.00\",\"-57.73\"],\"q_c\":[\"72.19\",\"0.00\",\"-57.56\"],\"s_color\":[\"green\",\"blue\",\"red\"],\"s_radio\":[10,10,10],\"v_ab\":[19999.99067499782,385.24087176236895,404.1437879343518],\"v_an\":[\"11547.00\",\"222.37\",\"234.96\"],\"v_bc\":[19999.990674997825,385.55935539882563,400.8756254986167],\"v_bn\":[\"11547.00\",\"222.49\",\"230.91\"],\"v_ca\":[19999.99067499783,385.57373912605533,400.6089760532399],\"v_cn\":[\"11547.00\",\"222.77\",\"230.22\"],\"v_ng\":[\"0.00\",\"0.00\",\"0.00\"],\"x\":[0,10,200],\"y\":[0,0,0]}},\"id\":\"ee9630d2-8c9c-44c3-a5b4-f1c797d7a92f\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"data_source\":{\"id\":\"6d915563-1e66-4daa-9b2c-875a8de179d7\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"d40b1035-6040-428f-b47c-2ad8ddc664b8\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"64d82f9a-fb44-4be4-a8ed-5ab71966890c\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"8762f9f3-be9b-4904-8051-b712e9484d3c\",\"type\":\"CDSView\"}},\"id\":\"2ca47ff4-c06c-43e3-a83c-3cde3dc1f8de\",\"type\":\"GlyphRenderer\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"2ca47ff4-c06c-43e3-a83c-3cde3dc1f8de\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            line id = @line_id \\n            <table border=\\\"1\\\">\\n                <tr>\\n                <td>I<sub>a</sub> =  @i_a_m &ang; @deg_a </td>\\n                </tr>\\n                <tr>\\n                <td>I<sub>b</sub> =  @i_b_m &ang; @deg_b </td>\\n                </tr>\\n                <tr>\\n                <td>I<sub>c</sub> =  @i_c_m &ang; @deg_c </td>\\n                </tr>\\n                <tr>\\n                <td>I<sub>n</sub> =  @i_n_m &ang; @deg_n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"6a16e989-a54e-43bc-adac-9f84f51f9068\",\"type\":\"HoverTool\"},{\"attributes\":{\"callback\":null,\"column_names\":[\"x_s\",\"y_s\",\"line_id\",\"i_a_m\",\"i_b_m\",\"i_c_m\",\"i_n_m\",\"deg_a\",\"deg_b\",\"deg_c\",\"deg_n\"],\"data\":{\"deg_a\":[-170.4911950530415],\"deg_b\":[69.16795537382151],\"deg_c\":[-51.59423685855887],\"deg_n\":[79.22082633079766],\"i_a_m\":[500.00000000000006],\"i_b_m\":[500.00000000000045],\"i_c_m\":[500.00000000000057],\"i_n_m\":[21.356696006799822],\"line_id\":[\"Bus_1-Bus_2\"],\"x_s\":[[10,200]],\"y_s\":[[0,0]]}},\"id\":\"6d915563-1e66-4daa-9b2c-875a8de179d7\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"plot\":null,\"text\":\"3 bus 4 wire system with transformer\"},\"id\":\"28585d4b-aea5-4437-937e-ddf9de0cdf73\",\"type\":\"Title\"},{\"attributes\":{\"below\":[{\"id\":\"3ddbf43c-8e90-464d-b16c-ad5ba5495bb1\",\"type\":\"LinearAxis\"}],\"left\":[{\"id\":\"83e91f9d-4962-4a62-b113-a7bcf8b4e40a\",\"type\":\"LinearAxis\"}],\"plot_height\":400,\"renderers\":[{\"id\":\"3ddbf43c-8e90-464d-b16c-ad5ba5495bb1\",\"type\":\"LinearAxis\"},{\"id\":\"cb40d40f-5796-4c96-8fde-eb5fe813ef38\",\"type\":\"Grid\"},{\"id\":\"83e91f9d-4962-4a62-b113-a7bcf8b4e40a\",\"type\":\"LinearAxis\"},{\"id\":\"667ee06d-3806-490a-a347-aa364404515a\",\"type\":\"Grid\"},{\"id\":\"4328a163-abb1-40cc-8ecb-0c022752413c\",\"type\":\"BoxAnnotation\"},{\"id\":\"2ca47ff4-c06c-43e3-a83c-3cde3dc1f8de\",\"type\":\"GlyphRenderer\"},{\"id\":\"b2d814b2-3c86-4cbf-b175-69d25c6a882b\",\"type\":\"GlyphRenderer\"}],\"title\":{\"id\":\"28585d4b-aea5-4437-937e-ddf9de0cdf73\",\"type\":\"Title\"},\"toolbar\":{\"id\":\"6a59db5b-179d-4668-9043-5d6c9ca348fa\",\"type\":\"Toolbar\"},\"x_range\":{\"id\":\"197672a7-f884-4a40-a415-7db32f8efaea\",\"type\":\"DataRange1d\"},\"x_scale\":{\"id\":\"dd1f47c7-527f-4c9c-afd1-cf37c7016f26\",\"type\":\"LinearScale\"},\"y_range\":{\"id\":\"70d9340c-18f0-4c78-989e-f6b1785f8c13\",\"type\":\"DataRange1d\"},\"y_scale\":{\"id\":\"b64b99a4-1db5-4ff2-bb72-f775384b9647\",\"type\":\"LinearScale\"}},\"id\":\"b0aad5eb-df20-43e1-8810-84d7c2f329ba\",\"subtype\":\"Figure\",\"type\":\"Plot\"},{\"attributes\":{},\"id\":\"ae921e23-f34d-4512-9564-a3ee878c7f09\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{\"callback\":null},\"id\":\"197672a7-f884-4a40-a415-7db32f8efaea\",\"type\":\"DataRange1d\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.1},\"fill_color\":{\"value\":\"#1f77b4\"},\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"707d2359-09bc-457b-84e9-386356b7a373\",\"type\":\"Circle\"},{\"attributes\":{\"data_source\":{\"id\":\"ee9630d2-8c9c-44c3-a5b4-f1c797d7a92f\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"ec1d4014-bead-4c15-a3e3-cb064f533b4d\",\"type\":\"Circle\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"707d2359-09bc-457b-84e9-386356b7a373\",\"type\":\"Circle\"},\"selection_glyph\":null,\"view\":{\"id\":\"fccb8d68-3046-4fca-a22a-8c3627b17a37\",\"type\":\"CDSView\"}},\"id\":\"b2d814b2-3c86-4cbf-b175-69d25c6a882b\",\"type\":\"GlyphRenderer\"},{\"attributes\":{\"active_drag\":\"auto\",\"active_inspect\":\"auto\",\"active_scroll\":\"auto\",\"active_tap\":\"auto\",\"tools\":[{\"id\":\"1067803d-ec55-48d7-9304-1742721d9606\",\"type\":\"PanTool\"},{\"id\":\"42446f4c-c75c-4685-8c56-89834cea4674\",\"type\":\"WheelZoomTool\"},{\"id\":\"f690873f-21f2-43f2-9335-dccaf06e6ddb\",\"type\":\"BoxZoomTool\"},{\"id\":\"f280bcef-7fe4-4557-8d48-98c5e75c3a60\",\"type\":\"SaveTool\"},{\"id\":\"08549134-19cf-4b16-92c5-8c7330c93193\",\"type\":\"ResetTool\"},{\"id\":\"5b4dc7c8-9732-4743-bec6-4017dfcdd5bd\",\"type\":\"HelpTool\"},{\"id\":\"6a16e989-a54e-43bc-adac-9f84f51f9068\",\"type\":\"HoverTool\"},{\"id\":\"7c22d503-7177-4917-a2f3-0e41c93b9a18\",\"type\":\"HoverTool\"}]},\"id\":\"6a59db5b-179d-4668-9043-5d6c9ca348fa\",\"type\":\"Toolbar\"},{\"attributes\":{\"source\":{\"id\":\"ee9630d2-8c9c-44c3-a5b4-f1c797d7a92f\",\"type\":\"ColumnDataSource\"}},\"id\":\"fccb8d68-3046-4fca-a22a-8c3627b17a37\",\"type\":\"CDSView\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"navy\"},\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"navy\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"ec1d4014-bead-4c15-a3e3-cb064f533b4d\",\"type\":\"Circle\"},{\"attributes\":{},\"id\":\"dd1f47c7-527f-4c9c-afd1-cf37c7016f26\",\"type\":\"LinearScale\"},{\"attributes\":{\"callback\":null},\"id\":\"70d9340c-18f0-4c78-989e-f6b1785f8c13\",\"type\":\"DataRange1d\"},{\"attributes\":{},\"id\":\"b64b99a4-1db5-4ff2-bb72-f775384b9647\",\"type\":\"LinearScale\"},{\"attributes\":{\"source\":{\"id\":\"6d915563-1e66-4daa-9b2c-875a8de179d7\",\"type\":\"ColumnDataSource\"}},\"id\":\"8762f9f3-be9b-4904-8051-b712e9484d3c\",\"type\":\"CDSView\"},{\"attributes\":{\"formatter\":{\"id\":\"2adba0ee-a342-4159-9ab6-e822a87a3d28\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"b0aad5eb-df20-43e1-8810-84d7c2f329ba\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"d7b0858e-031e-4d26-8dd5-78ad06d996c5\",\"type\":\"BasicTicker\"}},\"id\":\"3ddbf43c-8e90-464d-b16c-ad5ba5495bb1\",\"type\":\"LinearAxis\"},{\"attributes\":{},\"id\":\"d7b0858e-031e-4d26-8dd5-78ad06d996c5\",\"type\":\"BasicTicker\"},{\"attributes\":{\"plot\":{\"id\":\"b0aad5eb-df20-43e1-8810-84d7c2f329ba\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"d7b0858e-031e-4d26-8dd5-78ad06d996c5\",\"type\":\"BasicTicker\"}},\"id\":\"cb40d40f-5796-4c96-8fde-eb5fe813ef38\",\"type\":\"Grid\"},{\"attributes\":{\"formatter\":{\"id\":\"ae921e23-f34d-4512-9564-a3ee878c7f09\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"b0aad5eb-df20-43e1-8810-84d7c2f329ba\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"0a5dbfdd-2aab-4b06-8753-9f5ffeb15317\",\"type\":\"BasicTicker\"}},\"id\":\"83e91f9d-4962-4a62-b113-a7bcf8b4e40a\",\"type\":\"LinearAxis\"},{\"attributes\":{},\"id\":\"0a5dbfdd-2aab-4b06-8753-9f5ffeb15317\",\"type\":\"BasicTicker\"},{\"attributes\":{\"dimension\":1,\"plot\":{\"id\":\"b0aad5eb-df20-43e1-8810-84d7c2f329ba\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"0a5dbfdd-2aab-4b06-8753-9f5ffeb15317\",\"type\":\"BasicTicker\"}},\"id\":\"667ee06d-3806-490a-a347-aa364404515a\",\"type\":\"Grid\"},{\"attributes\":{\"bottom_units\":\"screen\",\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"lightgrey\"},\"left_units\":\"screen\",\"level\":\"overlay\",\"line_alpha\":{\"value\":1.0},\"line_color\":{\"value\":\"black\"},\"line_dash\":[4,4],\"line_width\":{\"value\":2},\"plot\":null,\"render_mode\":\"css\",\"right_units\":\"screen\",\"top_units\":\"screen\"},\"id\":\"4328a163-abb1-40cc-8ecb-0c022752413c\",\"type\":\"BoxAnnotation\"}],\"root_ids\":[\"b0aad5eb-df20-43e1-8810-84d7c2f329ba\"]},\"title\":\"Bokeh Application\",\"version\":\"0.12.7\"}};\n",
       "            var render_items = [{\"docid\":\"b702c0d1-6af4-49ec-a98e-6dec60c19f29\",\"elementid\":\"dda60240-c6fd-47ce-b044-031b9d82b5c1\",\"modelid\":\"b0aad5eb-df20-43e1-8810-84d7c2f329ba\"}];\n",
       "            \n",
       "            Bokeh.embed.embed_items(docs_json, render_items);\n",
       "          };\n",
       "          if (document.readyState != \"loading\") fn();\n",
       "          else document.addEventListener(\"DOMContentLoaded\", fn);\n",
       "        })();\n",
       "      },\n",
       "      function(Bokeh) {\n",
       "      }\n",
       "    ];\n",
       "  \n",
       "    function run_inline_js() {\n",
       "      \n",
       "      if ((root.Bokeh !== undefined) || (force === true)) {\n",
       "        for (var i = 0; i < inline_js.length; i++) {\n",
       "          inline_js[i].call(root, root.Bokeh);\n",
       "        }if (force === true) {\n",
       "          display_loaded();\n",
       "        }} else if (Date.now() < root._bokeh_timeout) {\n",
       "        setTimeout(run_inline_js, 100);\n",
       "      } else if (!root._bokeh_failed_load) {\n",
       "        console.log(\"Bokeh: BokehJS failed to load within specified timeout.\");\n",
       "        root._bokeh_failed_load = true;\n",
       "      } else if (force !== true) {\n",
       "        var cell = $(document.getElementById(\"dda60240-c6fd-47ce-b044-031b9d82b5c1\")).parents('.cell').data().cell;\n",
       "        cell.output_area.append_execute_result(NB_LOAD_WARNING)\n",
       "      }\n",
       "  \n",
       "    }\n",
       "  \n",
       "    if (root._bokeh_is_loading === 0) {\n",
       "      console.log(\"Bokeh: BokehJS loaded, going straight to plotting\");\n",
       "      run_inline_js();\n",
       "    } else {\n",
       "      load_libs(js_urls, function() {\n",
       "        console.log(\"Bokeh: BokehJS plotting callback run at\", now());\n",
       "        run_inline_js();\n",
       "      });\n",
       "    }\n",
       "  }(window));\n",
       "</script>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "sys1.bokeh_tools()\n",
    "\n",
    "p = figure(width=600, height=400,\n",
    "           title='3 bus 4 wire system with transformer') \n",
    "\n",
    "# lines:\n",
    "source = ColumnDataSource(sys1.line_data)\n",
    "lin = p.multi_line(source=source, xs='x_s', ys='y_s', color=\"red\", alpha=0.5, line_width=5)\n",
    "\n",
    "# buses:\n",
    "source = ColumnDataSource(sys1.bus_data)\n",
    "cr = p.circle(source=source, x='x', y='y', size=15, color=\"navy\", alpha=0.5)\n",
    "\n",
    "p.add_tools(HoverTool(renderers=[lin], tooltips=sys1.line_tooltip))\n",
    "p.add_tools(HoverTool(renderers=[cr], tooltips=sys1.bus_tooltip))\n",
    "show(p)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Get element transfomers results"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[{'R_cc_pu': 0.01,\n",
       "  'S_n_kVA': 150.0,\n",
       "  'U_1_kV': 20.0,\n",
       "  'U_2_kV': 0.4,\n",
       "  'X_cc_pu': 0.04,\n",
       "  'bus_j': 'Bus_0',\n",
       "  'bus_j_nodes': [1, 2, 3],\n",
       "  'bus_k': 'Bus_1',\n",
       "  'bus_k_nodes': [1, 2, 3, 4],\n",
       "  'conductors_1': 3,\n",
       "  'conductors_2': 4,\n",
       "  'connection': 'Dyn11',\n",
       "  'deg_1a': -140.66161983960993,\n",
       "  'deg_1b': 98.786859257631548,\n",
       "  'deg_1c': -21.042715955800332,\n",
       "  'deg_1n': -45.0,\n",
       "  'deg_2a': 9.5088049469581009,\n",
       "  'deg_2b': -110.83204462617836,\n",
       "  'deg_2c': 128.40576314144127,\n",
       "  'deg_2n': -123.50833870600022,\n",
       "  'i_1a_m': 10.017128868882283,\n",
       "  'i_1b_m': 10.038180285096967,\n",
       "  'i_1c_m': 9.9439626728354042,\n",
       "  'i_1n_m': 2.0097183471152322e-14,\n",
       "  'i_2a_m': 499.99999999999898,\n",
       "  'i_2b_m': 500.00000000000051,\n",
       "  'i_2c_m': 500.00000000000153,\n",
       "  'i_2n_m': 8.5171074987647515}]"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sys1.transformers"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[{'N_nodes': 3,\n",
       "  'U_kV': 20.0,\n",
       "  'bus': 'Bus_0',\n",
       "  'deg_an': 0.0,\n",
       "  'deg_bn': -119.99999999999999,\n",
       "  'deg_cn': 120.00000000000004,\n",
       "  'deg_ng': 0.0,\n",
       "  'p_a': -89459.289373142223,\n",
       "  'p_b': -90350.395089131969,\n",
       "  'p_c': -89288.029556916779,\n",
       "  'pos_x': 0,\n",
       "  'pos_y': 0,\n",
       "  'q_a': 73321.705556141067,\n",
       "  'q_b': 72609.4716291394,\n",
       "  'q_c': 72193.868405135727,\n",
       "  'units': 'm',\n",
       "  'v_ab': 19999.990674997822,\n",
       "  'v_an': 11547.0,\n",
       "  'v_bc': 19999.990674997825,\n",
       "  'v_bn': 11547.0,\n",
       "  'v_ca': 19999.990674997829,\n",
       "  'v_cn': 11547.0,\n",
       "  'v_ng': 0.0},\n",
       " {'N_nodes': 4,\n",
       "  'U_kV': 0.4,\n",
       "  'bus': 'Bus_1',\n",
       "  'deg_an': -24.878059416047435,\n",
       "  'deg_bn': -144.86643812443396,\n",
       "  'deg_cn': 95.158821252150531,\n",
       "  'deg_ng': -87.080736055349604,\n",
       "  'p_a': 0.0,\n",
       "  'p_b': -0.0,\n",
       "  'p_c': 0.0,\n",
       "  'pos_x': 10,\n",
       "  'pos_y': 0,\n",
       "  'q_a': -0.0,\n",
       "  'q_b': 0.0,\n",
       "  'q_c': 0.0,\n",
       "  'units': 'm',\n",
       "  'v_ab': 385.24087176236895,\n",
       "  'v_an': 222.37054785270075,\n",
       "  'v_bc': 385.55935539882563,\n",
       "  'v_bn': 222.49333844845916,\n",
       "  'v_ca': 385.57373912605533,\n",
       "  'v_cn': 222.76890552568096,\n",
       "  'v_ng': 0.001389628583262216},\n",
       " {'N_nodes': 4,\n",
       "  'U_kV': 0.4,\n",
       "  'bus': 'Bus_2',\n",
       "  'deg_an': -20.491506028093543,\n",
       "  'deg_bn': -140.8317665471059,\n",
       "  'deg_cn': 98.405796207263322,\n",
       "  'deg_ng': 92.919263944654915,\n",
       "  'p_a': 101738.97664512786,\n",
       "  'p_b': 99985.431273666647,\n",
       "  'p_c': 99690.015082239814,\n",
       "  'pos_x': 200,\n",
       "  'pos_y': 0,\n",
       "  'q_a': -58739.761811738979,\n",
       "  'q_b': -57725.968637596197,\n",
       "  'q_c': -57555.98033413857,\n",
       "  'units': 'm',\n",
       "  'v_ab': 404.14378793435179,\n",
       "  'v_an': 234.95683847462453,\n",
       "  'v_bc': 400.87562549861673,\n",
       "  'v_bn': 230.90581562299252,\n",
       "  'v_ca': 400.60897605323993,\n",
       "  'v_cn': 230.22415146392393,\n",
       "  'v_ng': 0.0013896285832620042}]"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sys1.buses"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "anaconda-cloud": {},
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 1
}
